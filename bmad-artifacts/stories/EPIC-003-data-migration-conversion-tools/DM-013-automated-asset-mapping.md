# User Story: Automated Asset Mapping from Table Data

**Epic**: [EPIC-003: Data Migration & Conversion Tools](bmad-artifacts/epics/EPIC-003-data-migration-conversion-tools.md)  
**Story ID**: DM-013  
**Created**: 2025-06-09  
**Status**: Draft

## Story Definition
**As a**: Conversion Manager  
**I want**: the conversion tool to automatically generate a detailed asset conversion map by parsing WCS table files (`.tbl`), with its logic informed by manual analysis of the C++ source code,  
**So that**: we can create a complete and accurate asset map that captures both data-driven and hardcoded asset dependencies.

## Acceptance Criteria
- [ ] **AC1**: The `AssetMapper` class is extended to parse WCS `.tbl` files (like `ships.tbl`) to discover data-driven asset relationships.
- [ ] **AC2**: The `AssetMapper`'s implementation correctly handles known hardcoded asset relationships discovered through manual analysis of the C++ source code.
- [ ] **AC3**: The `AssetMapper` generates a `project_mapping.json` file that defines source-to-target paths and conversion types for all related assets, combining data from `.tbl` files and hardcoded logic.
- [ ] **AC4**: The final `project_mapping.json` generated by the mapper accurately reflects the combined dependencies, linking all related assets to their parent entities (like ships or missions).

## Technical Requirements
- **Architecture Reference**: Extends `table_converter.py` and `migration_manager.py` from `bmad-artifacts/docs/EPIC-003-data-migration-conversion-tools/architecture.md`.
- **Godot Components**: Output will be consumed by `GodotProjectIntegrator` for semantic file organization.
- **Integration Points**: This provides a more robust implementation strategy for `DM-008: Asset Table Processing`.

## Implementation Notes
- **WCS Reference**: 
    - Table files: `ships.tbl`, `weapons.tbl`, etc.
    - C++ Source: The developer must manually analyze `source/code/**/*.cpp` to find hardcoded asset names (e.g., string literals ending in `.pof`, `.dds`) and incorporate this logic into the mapper.
- **Godot Approach**: Implement a robust table parser in Python. The mapper's logic will contain hardcoded rules and additions based on the manual C++ code review.
- **Key Challenges**: 
    - Ensuring the manual C++ code analysis is thorough.
    - Designing the `AssetMapper` to be easily extendable with new hardcoded rules as they are discovered.
- **Success Metrics**: The generated map for the Hermes campaign is at least 98% complete, requiring minimal manual correction.

## Dependencies
- **Prerequisites**: `DM-004: POF Format Analysis and Parser`.
- **Blockers**: None.
- **Related Stories**: This is a detailed implementation for `DM-008`. It will be used by `DM-015`.

## Definition of Done
- [ ] All acceptance criteria met and verified.
- [ ] Code follows Python standards with type hinting.
- [ ] Unit tests cover table parsing and the application of hardcoded mapping rules.
- [ ] The generated `project_mapping.json` is validated against a schema.
- [ ] Code reviewed and approved by Mo (Godot Architect) and Larry (WCS Analyst).

## Estimation
- **Complexity**: Complex
- **Effort**: 3 days
- **Risk Level**: Medium
- **Confidence**: Medium
